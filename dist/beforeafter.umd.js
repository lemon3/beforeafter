/*!
* BeforeAfter v0.2.1
* undefined
*/
(function(c,l){typeof exports=="object"&&typeof module!="undefined"?module.exports=l():typeof define=="function"&&define.amd?define(l):(c=typeof globalThis!="undefined"?globalThis:c||self,c.BeforeAfter=l())})(this,function(){"use strict";var X=Object.defineProperty;var Y=(c,l,m)=>l in c?X(c,l,{enumerable:!0,configurable:!0,writable:!0,value:m}):c[l]=m;var u=(c,l,m)=>(Y(c,typeof l!="symbol"?l+"":l,m),m);const c={_s:new WeakMap,put(s,...i){this._s.has(s)||this._s.set(s,new Map);let t=this._s.get(s);if(i.length>1)return t.set(i[0],i[1]),this;if(typeof i[0]=="object")for(const e in i[0])t.set(e,i[0][e]);else t.set(i[0]);return this},get(s,i){return this._s.has(s)?i?this._s.get(s).get(i):this._s.get(s):!1},has(s,i){return this._s.has(s)&&this._s.get(s).has(i)},remove(s,i){if(!this._s.has(s))return!1;let t=this._s.get(s).delete(i);return this._s.get(s).size===0&&this._s.delete(s),t}},l=s=>{const i="DOMContentLoaded";document.readyState==="complete"||document.readyState==="interactive"?(s(),document.removeEventListener(i,s)):document.addEventListener(i,s,!1)},m=s=>new Promise((i,t)=>{const e=new Image;e.onload=()=>{const{naturalWidth:n,naturalHeight:a}=e,r=n/a;i({width:n,height:a,ratio:r})},e.onerror=()=>{t("error")},e.src=s}),N=(s,i,t=null)=>{if(!s)return!1;if(i===void 0||s.dataset[i]===void 0)return s.dataset;let e;try{e=JSON.parse(s.dataset[i].replace(/'/g,'"'))}catch(r){}if(typeof e!="object"){e=s.dataset[i];const r={};e=e.replace(/[\\ \t\n\r]/g,""),e=e.replace(/{?([^{])}?/g,"$1");const o=e.split(",");o.length>1?o.forEach(E=>{if(E){let[D,f]=E.split(":");f=f.replace(/'/g,""),f==="true"?f=!0:f==="false"&&(f=!1),r[D.replace(/'/g,"")]=f}}):r[i]=e,e=r}let n={},a=i.length;return Object.entries(s.dataset).forEach(r=>{if(r[0].toLowerCase().indexOf(i)>=0&&r[0].length>a){let o=r[0][a].toLowerCase()+r[0].substring(a+1);(t===null||t&&t[o]!==void 0)&&(n[o]=r[1])}}),Object.assign(e,n)};let p=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){return p={passive:!1},!1}}))}catch(s){p=!1}const T=(s,i,t)=>{if(s=parseFloat(s,10),i=parseFloat(i,10),t=parseFloat(t,10),t<i){let e=t;t=i,i=e}return!isNaN(i)&&s<i?i:!isNaN(t)&&s>t?t:s},k=(s,i)=>{if(!s||!i&&!s)return!1;if(s&&!i)return s;s[0]===void 0&&(s=[s]);const t=s[0],e=t.parentNode;return e&&e.insertBefore(i,t),s.forEach(n=>{i.appendChild(n)}),i},F=(s,i,t,e)=>{if(i)for(let n in i)Object.prototype.hasOwnProperty.call(i,n)&&s.setAttribute(n,i[n]);if(t)for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s.style[n]=t[n]);return e&&(s.innerHTML=e),s},d=(s,i,t,e)=>F(document.createElement(s),i,t,e),M={Quad:{easeIn:s=>Math.pow(s,2),easeOut:s=>1-Math.pow(1-s,2)},Cubic:{easeIn:s=>Math.pow(s,3),easeOut:s=>1-Math.pow(1-s,3)},Sine:{easeIn:s=>1-Math.cos(s*Math.PI/2),easeOut:s=>Math.sin(s*Math.PI/2)},Elastic:{easeOut:s=>{const i=2*Math.PI/3;return s===0||s===1?s:Math.pow(2,-10*s)*Math.sin((s*10-.75)*i)+1}}},z={autoInit:!0,beforeImage:null,afterImage:null,followMouse:!1,onlyHandleDraggable:!1,clickable:!1,snapToStart:!1,snapToStartDelay:250,afterOnTheRight:!1,handleMinDistance:0,dragElementClass:"beforeafter-handle",dragCallback:null,animateInDuration:1250,animateInEasing:M.Elastic.easeOut,animateInDelay:100,animateStartPos:40,startPos:50,animateDuration:250,animateEasing:M.Cubic.easeOut,beforeLabel:"",afterLabel:"",beforeDescription:"",afterDescription:"",showToggleButton:!1,toggleBeforeText:"show before",toggleAfterText:"show after"},R=(s,i,t)=>{let e=s.getAttribute("on"+i);new Function("e","{"+e+"}").call(s,t)};class j{constructor(){this._eventCallbacks=this._eventCallbacks||{}}emit(i,t){let e=this._eventCallbacks[i];const n={bubbles:!1,cancelable:!1,detail:t},a=new CustomEvent(i,n);e&&e.forEach(r=>r.call(this,a)),this.element&&(this.element.dispatchEvent(a),R(this.element,i,a))}addEventListener(i,t){return this.allowedEvents&&this.allowedEvents.indexOf(i)<0||typeof t!="function"?!1:(this._eventCallbacks[i]||(this._eventCallbacks[i]=[]),this._eventCallbacks[i].push(t),this)}removeEventListener(i,t){if(!this._eventCallbacks||arguments.length===0)return this._eventCallbacks={},this;let e=this._eventCallbacks[i];return e?arguments.length===1?(delete this._eventCallbacks[i],this):(this._eventCallbacks[i]=e.filter(n=>n!==t),this):this}}const w="beforeafter",$="data-"+w,_="interacting",x="init",H="drag",B="update",y="beforeshown",A="aftershown",L="interactionend",P="mousedown",W="resize";let v=[],O=!1;class g extends j{constructor(t,e){if(!t)return{error:!0};if(t=typeof t=="string"?document.querySelector(t):t,t===null||t.length===0)return{error:!0};super();u(this,"_interactionEnd",()=>{this.element.classList.remove(_),this.isTouch?this._mouseStartEvents():this._touchStartEvent(),this.settings.snapToStart&&this._snapToStart()});u(this,"_dimensions",()=>{this.elementWidth=this.canvas.offsetWidth,this.elementOffsetLeft=this.offsetElements.map(t=>t.offsetLeft).reduce((t,e)=>t+e),this.dragHandleWidth=this.dragHandle.offsetWidth,this.minLeftPos=this.elementOffsetLeft+this.settings.handleMinDistance-this.dragHandleWidth/2,this.maxLeftPos=this.elementOffsetLeft+this.elementWidth-this.dragHandleWidth/2-this.settings.handleMinDistance,this.elementHeight=this.canvas.offsetHeight,this.oldElementWidth!==this.elementWidth&&(this.oldElementWidth=this.elementWidth,this._setPosition(this.currentPercent,!0))});u(this,"_mouseOver",()=>{this._stopAni(),this.element.classList.add(_)});u(this,"_mouseOut",()=>{this.element.classList.remove(_),this.settings.snapToStart&&this._snapToStart()});u(this,"_mouseMove",t=>{this._stopAni();let e=this._getPos(t),n=this._calcLeftPercent(e.x);this._setPosition(n)});u(this,"_tapstart",t=>{this._endInteraction=!1,this._stopAni(),clearTimeout(this.snapTimeout),t.type==="touchstart"?(this.isTouch=!0,this._mouseStartEvents(!1)):P===t.type&&(this.isTouch=!1,this._touchStartEvent(!1));const e=this._calcLeftPercent(this._getPos(t).x);this._animateTo(e,this.settings.animateDuration)});u(this,"_dragStart",t=>{t.stopPropagation(),this.startPos=this._getPos(t),this.element.classList.add(_),this._tapstart(t),t.type==="touchstart"?(window.addEventListener("touchmove",this._drag,p),window.addEventListener("touchend",this._dragEnd,!1)):P===t.type&&(this.settings.followMouse||(window.addEventListener("mousemove",this._drag,!1),window.addEventListener("mouseup",this._dragEnd,!1)))});u(this,"_drag",t=>{this._stopAni();let e=this._getPos(t),n=this._calcLeftPercent(e.x);if(this.isTouch&&(t.preventDefault(),this.deltaX=Math.abs(this.startPos.x-e.x),this.deltaY=Math.abs(this.startPos.y-e.y),!this.dirDetected)){if(this.deltaY>this.deltaX){this.element.classList.remove(_),window.removeEventListener("touchmove",this._drag,p);return}this.element.classList.add(_),this.dirDetected=!0}this._setPosition(n),this.emit(H,{percent:n})});u(this,"_dragEnd",t=>{this._endInteraction=!0,t.type==="touchend"?(this.isTouch=!0,window.removeEventListener("touchmove",this._drag,p),window.removeEventListener("touchend",this._dragEnd)):t.type==="mouseup"&&(this.isTouch=!1,this.settings.followMouse||(window.removeEventListener("mousemove",this._drag,!1),window.removeEventListener("mouseup",this._dragEnd,!1))),this._testInteractionEnd(),this.dirDetected=!1});u(this,"toggleBeforeAfter",t=>{t&&t.stopPropagation(),this._stopAni(),this._afterShown?this.showBefore():this.showAfter()});if(t.dataset.bainitialized)return g.getInstance(t);t.dataset.bainitialized=!0,this.allowedEvents=[x,H,B,y,A,L],v.push(this),c.put(t,"instance",this),this.element=t;const n=N(t,w);if(this.options=e||{},this.settings=Object.assign({},g.defaults,n,e),this.images=this.element.querySelectorAll("img"),(!this.settings.beforeImage||!this.settings.afterImage)&&(!this.images||!this.images.length))return{error:!0};this.element.classList.contains(w)||this.element.classList.add(w),this.snapTimeout=null,this.deltaX=0,this.deltaY=0,this.dirDetected=!1,this.settings.autoInit&&this.init()}_getPos(t){let e;return typeof t.pageX!="undefined"?e=t:e=t.touches[0]||t.changedTouches[0],{x:e.pageX,y:e.pageY}}_createGui(){const t=this.settings;this.originalElements=[],this.createdElements=[];const e="div",n=d(e,{class:"canvas"});this.createdElements.push(n);let a,r,o,E,D=!1;t.beforeImage||t.afterImage?(D=!0,a=d("img",{draggable:!1}),a.src=t.beforeImage,r=d("img",{draggable:!1}),r.src=t.afterImage):([o,E]=this.originalElements=this.images,a=o.cloneNode(!0),a.setAttribute("draggable",!1),r=E.cloneNode(!0),r.setAttribute("draggable",!1));const f=d(e,{class:"clipSlider"},{zIndex:2}),I=document.createDocumentFragment(),b=document.createDocumentFragment();I.appendChild(a),b.appendChild(r);let S;if(t.beforeLabel!==""){const h=d(e,{class:"label left"});h.innerHTML=t.beforeLabel,S=d(e,{class:"clipSlider"}),S.append(h),b.appendChild(S)}if(t.afterLabel!==""){const h=d(e,{class:"label right"});h.innerHTML=t.afterLabel,I.appendChild(h)}f.appendChild(I),D?(n.append(f),n.append(b),this.element.append(n)):(o.parentNode.replaceChild(f,o),E.remove(),k([f,b],n));const C=d(e,{class:t.dragElementClass},{zIndex:5}),G=d(e);if(C.appendChild(G),n.appendChild(C),t.beforeDescription!==""||t.afterDescription!==""){const h=d(e,{class:"description"});h.innerHTML=t.beforeDescription,this.element.appendChild(h),this.createdElements.push(h),this.description=h}if(t.showToggleButton){const h=d(e,{class:"toggleButton"},{zIndex:5});h.innerHTML=this._buttonStartText,this.element.appendChild(h),this.createdElements.push(h),this.toggleBtn=h}this.element.style.visibility="visible",this.wrapper1=I,this.wrapper2=b,this.dragHandle=C,this.clip=S,this.clippingElement=f,this.canvas=n}_mouseStartEvents(t=!0){const e=(t?"add":"remove")+"EventListener",n=this.settings;if(n.followMouse){const a=this.canvas;a[e]("mouseenter",this._mouseOver,!1),a[e]("mouseleave",this._mouseOut,!1),a[e]("mousemove",this._mouseMove,!1)}else this.dragElementTrigger[e](P,this._dragStart),n.onlyHandleDraggable&&n.clickable&&(this.canvas[e](P,this._tapstart,!1),this.canvas[e]("mouseup",this._dragEnd,!1))}_touchStartEvent(t=!0){const e=(t?"add":"remove")+"EventListener";this.dragElementTrigger[e]("touchstart",this._dragStart,p),this.settings.clickable&&(this.canvas[e]("touchstart",this._tapstart,!1),this.canvas[e]("touchend",this._dragEnd,!1))}_removeAllEvents(){this._mouseStartEvents(!1),this._touchStartEvent(!1),this.toggleBtn&&this.toggleBtn.removeEventListener("click",this.toggleBeforeAfter),window.removeEventListener(W,this._dimensions),this.removeEventListener(L,this._interactionEnd)}_addEvents(){this._touchStartEvent(),this._mouseStartEvents(),this.toggleBtn&&this.toggleBtn.addEventListener("click",this.toggleBeforeAfter,!1),window.addEventListener(W,this._dimensions),this.addEventListener(L,this._interactionEnd)}_stopAni(){this._renderId&&(window.cancelAnimationFrame(this._renderId),this._renderId=void 0,this.timing.then=this.timing.curTime=0)}_testInteractionEnd(){this._endInteraction&&this._renderId===void 0&&(this._endInteraction=!1,this.emit(L))}_renderLoop(t,e,n){const a=()=>{const r=new Date().getTime(),o=r-(this.timing.then||r);if(this.timing.curTime+=o,this.progress=this.timing.curTime/this._animationDuration,this.progress>=1){this.progress=1,this._setPosition(e),this._stopAni(),this._testInteractionEnd();return}this._setPosition(t+n*this.easing(this.progress)),this.timing.then=r,this._renderId=window.requestAnimationFrame(a)};a()}_animateTo(t,e,n){if(t=T(+t,0,100),this._delta=t-this.currentPercent,!(Math.abs(this._delta)<1)){if(!e){this._setPosition(t);return}this._animationDuration=e,this.easing=n||this.settings.animateEasing,this.progress=0,this.timing.then=this.timing.curTime=0,this._renderLoop(this.currentPercent,t,this._delta)}}_snapToStart(t=this.settings.snapToStartDelay){this._stopAni(),this.snapTimeout=setTimeout(()=>{this._animateTo(this.settings.startPos,this.settings.animateDuration,this.settings.animateEasing)},t)}_getOffsetElements(){const t=[this.element];let e=this.element.offsetParent;if(!e)return t;do{if(t.push(e),!e.offsetParent)break;e=e.offsetParent}while(e.nodeName!=="BODY");return t}_setToggleValues(t,e,n){this.toggleBtn&&(this.toggleBtn.innerHTML=e),this.description&&(this.description.innerHTML=n),this._afterShown=t===1,this._oneTime=!1}_setPosition(t,e=!1){if(t===this.currentPercent&&!e)return!1;this.currentPercent=t;let n=this.elementWidth*t*.01,a=`rect(0 ${n}px ${this.elementHeight}px 0)`,r=`rect(0 ${this.elementWidth}px ${this.elementHeight}px ${n}px)`,o;this._clipFromLeft||(o=a,a=r,r=o),this.clip&&(this.clip.style.clipPath=r),this.clippingElement.style.clipPath=a,this.dragHandle.style.transform=`translate(${n}px, 0)`,t>75&&(!this._afterShown||this._oneTime)?(this._setToggleValues(1,this.settings.toggleBeforeText,this.settings.afterDescription),this.emit(this.afterOnTheRight?A:y)):t<25&&(this._afterShown||this._oneTime)&&(this._setToggleValues(0,this.settings.toggleAfterText,this.settings.beforeDescription),this.emit(this.afterOnTheRight?y:A)),this.emit(B,{percent:t})}_calcLeftPercent(t){return t=T(t,this.minLeftPos,this.maxLeftPos),(t+this.dragHandleWidth*.5-this.elementOffsetLeft)*100/this.elementWidth}_calcLeftValue(t){return T(t,0,100)*.01*this.elementWidth+this.elementOffsetLeft-this.dragHandleWidth*.5}init(){if(this._initialized)return this;this._initialized=!0,this._oneTime=!0;const t=this.settings;if(this._afterShown=!1,this._clipFromLeft=!0,this._buttonStartText=this.settings.toggleAfterText,!t.afterOnTheRight){let n=t.afterDescription;t.afterDescription=t.beforeDescription,t.beforeDescription=n;let a=t.toggleAfterText;t.toggleAfterText=t.toggleBeforeText,t.toggleBeforeText=a,this._afterShown=!0,this._buttonStartText=this.settings.toggleBeforeText,this._clipFromLeft=!1}this._createGui(),this.offsetElements=this._getOffsetElements(),this.timing={time:0,curTime:0},this.dragElementTrigger=t.onlyHandleDraggable?this.dragHandle:this.canvas,this._animationDuration=t.animateInDuration||0,t.startPos||(t.startPos=0),t.animateStartPos||(t.animateStartPos=0),this.currentPercent=this._animationDuration>0?t.animateStartPos:t.startPos,this.element.style.opacity=0,this.isTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0;let e=this.settings.beforeImage||this.images[0].src;m(e).then(n=>{this.imageDimensions=n,this._dimensions(),this._setPosition(this.currentPercent),this.element.style.opacity=1,this._animationDuration>0&&this.settings.animateStartPos!==this.settings.startPos&&setTimeout(()=>this._animateTo(this.settings.startPos,this._animationDuration,this.settings.animateInEasing),this.settings.animateInDelay),this._addEvents(),this.emit(x)})}goto(t,e,n){if(isNaN(t)||(t=T(+t,0,100),t===this.currentPercent))return!1;this._stopAni(),this._animateTo(t,e,n)}showAfter(){this._setPosition(100)}showBefore(){this._setPosition(0)}get elem(){return this.element}destroy(){if(this.element.removeAttribute("data-bainitialized"),typeof this.createdElements=="undefined")return!1;this.createdElements.forEach(t=>this.element.removeChild(t)),this.originalElements.forEach(t=>this.element.appendChild(t)),this.createdElements=[],this.originalElements=[],this._removeAllEvents(),this._initialized=!1}}return g.init=()=>{if(O)return!0;O=!0;let s=document.querySelectorAll("["+$+"]");return s.length===0?!1:(s.forEach(i=>{new g(i)}),v)},g.destroyAll=()=>v.length?(v.forEach(s=>{s.destroy()}),O=!1,v=[],!0):!1,g.getInstance=s=>c.get(s,"instance"),g.defaults=z,l(g.init),g});
